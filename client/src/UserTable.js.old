import React from 'react';
import { makeStyles } from '@material-ui/core/styles';
import { Table, TableBody, TableCell, TableContainer, TableHead, TableRow }  from '@material-ui/core';
import Switch from '@material-ui/core/Switch';
import { IconButton, Button } from '@material-ui/core/';
import AddIcon from '@material-ui/icons/Add';
import { Card, CardContent, CardActions } from '@material-ui/core/';
import CircularProgress from '@material-ui/core/CircularProgress';
import { Dialog, DialogActions, DialogContent,DialogContentText, DialogTitle } from '@material-ui/core/';
import { API_ROOT } from './api-config';
import { useAsync, useFetch } from "react-async"
import Snackbar from '@material-ui/core/Snackbar';
import CloseIcon from '@material-ui/icons/Close';

const useStyles = makeStyles(theme => ({
    circular: {
      position: 'absolute',
      right: '50%',
      display: 'flex',
      '& > * + *': {
        marginLeft: theme.spacing(2),
      },
    },
    table: {
        minWidth: 650,
    },
  }));


export default function UserTable() {
    const classes = useStyles();

    const [openDialog, setOpenDialog] = React.useState(false);
    const handleClickOpen = () => {
        setOpenDialog(true);
    };
    const handleCloseDialog = () => {
        setOpenDialog(false);
    };

    const headers = { Accept: "application/json" }
    const { users, error, isPending, run } = useFetch(API_ROOT+"user/list", { headers })

    
    let progress =  isPending ? <div className={classes.circular}><CircularProgress /></div> : <div></div>;

    const getUsers= (users) => {
        if (users == undefined) return []
        return users
    }
    const getMessage = (error) => {
        if (error == undefined) return "Error Fetching data"
        return error.message
    }

    return (
    <Card>
        <CardContent>
            <TableContainer>
                <Table className={classes.table} aria-label="user table">
                    <TableHead>
                        <TableRow>
                            <TableCell>Username</TableCell>
                            <TableCell>Created</TableCell>
                            <TableCell>Status</TableCell>
                            <TableCell>Enabled</TableCell>
                        </TableRow>
                    </TableHead>
                    <TableBody> 
                        {progress}
                        {getUsers(users).map(row => (
                        <TableRow key={row.username}>
                            <TableCell component="th" scope="row">{row.username}</TableCell>
                            <TableCell>{row.created}</TableCell>
                            <TableCell>{row.status}</TableCell>
                            <TableCell>
                                <Switch checked={row.enabled} color="primary" value="checkedEnabled" inputProps={{ 'aria-label': 'primary checkbox' }} />
                            </TableCell>
                        </TableRow>
                        ))}
                    </TableBody>
                </Table>
            </TableContainer>
        </CardContent>
        <CardActions>
            <IconButton aria-label="add user" onClick={handleClickOpen}>
                <AddIcon/>
            </IconButton>
        </CardActions>
        <Dialog open={openDialog} onClose={handleCloseDialog} aria-labelledby="form-dialog-title">
            <DialogTitle id="form-dialog-title">Add User</DialogTitle>
            <DialogContent>
            <DialogContentText>
                To add an user, please enter a username and password here.
            </DialogContentText>

            </DialogContent>
            <DialogActions>
          <Button onClick={handleCloseDialog} color="primary">
            Cancel
          </Button>
          <Button onClick={handleCloseDialog} color="primary">
            Add
          </Button>
        </DialogActions>
        </Dialog>
        <Snackbar 
            anchorOrigin={{vertical: 'bottom',horizontal: 'left'}}
            open={error}
            autoHideDuration={60}
            ContentProps={{'aria-describedby': 'message-id'}}
            message={<span id="message-id">{getMessage(error)}</span>}
            >
        </Snackbar> 
    </Card>

  );
}